# pd-ut

pd-ut is a tool to run unit tests for PD.

## Build

1. [Go](https://golang.org/) Version 1.23 or later
2. In the root directory of the [PD project](https://github.com/tikv/pd), use the `make pd-ut` command to compile and generate `bin/pd-ut`

## Usage

This section describes how to use the pd-ut tool.

### brief run all tests
```shell
make ut 
```


### run by pd-ut

- You should `make failpoint-enable` before running the tests.
- And after running the tests, you should `make failpoint-disable` and `make clean-test` to disable the failpoint and clean the environment.

#### Flags description

```shell
// run all tests
pd-ut

// show usage
pd-ut -h

// list all packages
pd-ut list

// list test cases of a single package
pd-ut list $package

// list test cases that match a pattern
pd-ut list $package 'r:$regex'

// run all tests
pd-ut run

// run test all cases of a single package
pd-ut run $package

// run test cases of a single package
pd-ut run $package $test

// run test cases that match a pattern
pd-ut run $package 'r:$regex'

// build all test package
pd-ut build

// build a test package
pd-ut build xxx

// write the junitfile
pd-ut run --junitfile xxx

// test with race flag
pd-ut run --race

// test with coverprofile
pd-ut run --coverprofile xxx
go tool cover --func=xxx
```

# Test file

The filename is hashed by the executed testcase name. If you generate a new file by `pd-ut`, you need not to upload them to master branch.

- 6318324486113443275.key: this file is generated by `./scripts/ci-subtask.sh 1`
- 1268802495307676306.key: this file is generated by `./scripts/ci-subtask.sh 2`
- 1458787306052961079.key: this file is generated by `./scripts/ci-subtask.sh 3`
- 6796122266502937016.key: this file is generated by `./scripts/ci-subtask.sh 7`
- 3538547533638094269.key: this file is generated by `./scripts/ci-subtask.sh 8`
- 13771733152242553546.key: this file is generated by `./scripts/ci-subtask.sh 9`
- 6381482492167697560.key: this file is generated by `./scripts/ci-subtask.sh 10`